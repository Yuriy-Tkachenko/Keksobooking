(()=>{var e={808:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector(".ad-form-header__input"),o=document.querySelector(".ad-form-header__image"),r=document.querySelector(".ad-form__input"),a=document.querySelector(".ad-form__photo"),l=document.createElement("img");a.appendChild(l);const s=(t,o)=>{t.addEventListener("change",(()=>{const r=t.files[0],a=r.name.toLowerCase();if(e.some((e=>a.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{o.src=e.result})),e.readAsDataURL(r)}}))};s(t,o),s(r,l)}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,o),l.exports}(()=>{"use strict";const e={bungalow:"0",flat:"1000",hotel:"3000",house:"5000",palace:"10000"},t=document.querySelector(".ad-form"),r=t.querySelector("#title"),a=t.querySelector("#type"),l=t.querySelector("#price"),s=t.querySelector("#timein"),c=t.querySelector("#timeout"),n=t.querySelector("#room_number"),d=t.querySelector("#capacity"),u=(t.querySelector("#address"),t.querySelector(".ad-form__reset"),document.querySelector(".ad-form-header__preview")),i=(document.querySelector(".ad-form__photo"),u.querySelector("img").cloneNode(!0),t.querySelector("#avatar"),t.querySelector("#images"),()=>{c.value=s.value,s.value=c.value}),p=()=>{"1"===n.value&&"1"!==d.value?(d.style.borderColor="red",d.setCustomValidity("В 1 комнате возможно разместить только 1 гостя")):"2"===n.value&&"1"!==d.value&&"2"!==d.value?(d.style.borderColor="red",d.setCustomValidity("В 2 комнатах возможно разместить только 2 гостей")):"3"===n.value&&"0"===d.value?(d.style.borderColor="red",d.setCustomValidity("В 3 комнатах возможно разместить только 3 гостей")):"100"===n.value?(d.style.borderColor="red",d.setCustomValidity("Нет свободных номеров, в которых предусмотрено 100 комнат")):(d.style.borderColor="",d.setCustomValidity("")),d.reportValidity()};r.addEventListener("input",(()=>{const e=r.value.length;e<30?(r.style.borderColor="red",r.setCustomValidity("Минимальная длина составляет 30 символов")):e>100?(r.style.borderColor="red",r.setCustomValidity("Максимальная длина составляет 100 символов")):(r.style.borderColor="",r.setCustomValidity("")),r.reportValidity()})),a.addEventListener("change",(()=>{l.placeholder=e[a.value],l.min=e[a.value]})),l.addEventListener("input",(()=>{const t=l.value;t<e[a.value]?(l.style.bordercolor="red",l.setCustomValidity(`Минимальная цена за ночь составляет ${e}`)):t>1e6?(l.style.borderColor="red",l.setCustomValidity("Максимальная цена за ночь составляет 1000000")):(l.style.borderColor="white",l.setCustomValidity("")),l.reportValidity()})),s.addEventListener("change",i),c.addEventListener("change",i),n.addEventListener("change",p),d.addEventListener("change",p);const y=()=>{t.reset()};o(808);const m=document.querySelector(".ad-form"),_=m.querySelectorAll("fieldset"),v=document.querySelector(".map__filters"),S=v.querySelectorAll(".map__filter"),h=v.querySelectorAll(".map__checkbox"),g=v.querySelector(".map__features"),q=e=>{e.forEach((e=>{e.setAttribute("disabled","disabled")}))},f=e=>{e.forEach((e=>{e.removeAttribute("disabled")}))},b=(e,t,o,r)=>{if(e>10&&1===Math.round(e%100/10))return r;switch(e%10){case 1:return t;case 2:case 3:case 4:return o}return r},x=e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},C=document.querySelector("#card").content.querySelector(".popup"),E=35.682064,k=139.752136,V=document.getElementById("address");m.classList.add("ad-form--disabled"),v.classList.add("ad-form--disabled"),g.classList.add("ad-form--disabled"),q(_),q(S),q(h);const w=L.map("map-canvas").on("load",(()=>{m.classList.remove("ad-form--disabled"),v.classList.remove("ad-form--disabled"),g.classList.remove("ad-form--disabled"),f(_),f(S),f(h)})).setView({lat:E,lng:k},14);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(w);const A=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),$=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});L.marker({lat:E,lng:k},{draggable:!0,icon:A}).on("moveend",(e=>{const{lat:t,lng:o}=e.target.getLatLng();V.value=`${t.toFixed(6)}, ${o.toFixed(6)}`})).addTo(w);const T=L.layerGroup().addTo(w),z=document.querySelector(".map__filters"),j=(z.querySelector("#housing-type"),z.querySelector("#housing-price"),z.querySelector("#housing-rooms"),z.querySelector("#housing-guests"),z.querySelector(".map__features"),document.querySelector(".map__filters"),document.querySelector(".ad-form"));var F,D;fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{e.slice(0,"10").forEach((e=>{const{location:t}=e;L.marker({lat:t.lat,lng:t.lng},{icon:$}).addTo(T).bindPopup((()=>(({author:e,offer:t})=>{const o=C.cloneNode(!0);var r;return t.title?o.querySelector(".popup__title").textContent=t.title:o.querySelector(".popup__title").remove(),t.address?o.querySelector(".popup__text--address").textContent=t.address:o.querySelector(".popup__text--address").remove(),t.price?o.querySelector(".popup__text--price").textContent=`${t.price} ₽/ночь`:o.querySelector(".popup__text--price").remove(),t.type?o.querySelector(".popup__type").textContent=t.type:o.querySelector(".popup__type").remove(),t.rooms&&t.guests?o.querySelector(".popup__text--capacity").textContent=`${t.rooms} ${b(t.rooms,"комната","комнаты","комнат")} для ${t.guests} ${b(t.guests,"гостя","гостей","гостей")}`:o.querySelector(".popup__text--capacity").remove(),t.checkin&&t.checkout?o.querySelector(".popup__text--time").textContent=`Заезд после ${t.checkin}, выезд до ${t.checkout}`:o.querySelector(".popup__text--time").remove(),t.description?o.querySelector(".popup__description").textContent=t.description:o.querySelector(".popup__description").remove(),e.avatar?o.querySelector(".popup__avatar").src=e.avatar:o.querySelector(".popup__avatar").remove(),t.photos?o.querySelector(".popup__photos").appendChild(((e,t)=>{let o=e.querySelector(".popup__photo");e.innerHTML="";const r=document.createDocumentFragment();return t.forEach((e=>{const t=o.cloneNode(!0);t.src=e,r.appendChild(t)})),r})(o.querySelector(".popup__photos"),t.photos)):o.querySelector(".popup__photos").remove(),t.features?(r=t.features,o.querySelector(".popup__features").querySelectorAll("li").forEach((e=>{-1===r.indexOf(e.classList[1].replace("popup__feature--",""))&&e.remove()}))):o.querySelector(".popup__features").remove(),o})(e)),{keepInview:!0})}))})).catch((()=>{x("Ошибка! Попробуйте перезагрузить страницу!")})),F=()=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="green",t.textContent="Форма успешно отправлена!",document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})(),y()},D=()=>{x("Не удалось отправить форму. Попробуйте еще раз."),y()},j.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target);fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((()=>F())).catch((()=>D()))}))})()})();
//# sourceMappingURL=main.bundle.js.map